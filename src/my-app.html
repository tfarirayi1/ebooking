<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-badge/paper-badge.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="shopping-basket-data.html">
<link rel="import" href="shop-list.html">
<link rel="import" href="shop-basket.html">

<dom-module id="my-app">
  <template>
    <style>
      :host {
        display: block;
        @apply(--layout-fullbleed);
        @apply(--layout-vertical);
      }

      app-box {
        box-sizing: border-box;
        padding: 13px;
        @apply(--layout-fullbleed);
        --app-box-background-front-layer: {
          background-color: #263238;
        }
      }

      paper-fab {
        --paper-fab-background: #CFD8DC;
        color: #263238;
        /*margin: auto;*/
      }

      .basket-button {
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        margin: auto;
      }

      paper-badge.numitems {
      }

      paper-scroll-header-panel {
            background-color: #263238;
            @apply(--layout-flex);
            /* background for toolbar full size */
            --paper-scroll-header-panel-full-header: {
                /*background-color: #B0BEC5;*/
                background-color: #263238;
                background-color: transparent;
                border-radius: 0px 0px 16px 16px;
            };
            /* background for toolbar condensed */
            --paper-scroll-header-panel-condensed-header: {
                background-color: #263238;
                background-color: transparent;
                color: red !important;
            };
        }

        paper-toolbar {
          background-color: transparent;
          color: #455A64;
        }

      .main-title {
        max-width: 400px;
        margin: auto;
      }

      .spacer {
      }
    </style>

    <app-location route="{{route}}"></app-location>
    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>

        <shopping-basket-data
          id="basket"
          basket="{{basket}}"
          num-items="{{numItems}}"
          total="{{total}}">
        </shopping-basket-data>

        <!-- Header Content -->
        <paper-scroll-header-panel id="header" fixed>

          <!-- Toolbar -->
          <paper-toolbar bottom-justify="center" justify="end">
              <paper-icon-button id="contact" on-click="toggleContact" icon="my-icons:phone-iphone"></paper-icon-button>
              <paper-icon-button id="message" on-click="toggleMessage" icon="my-icons:mail"></paper-icon-button>
              <paper-icon-button id="about" on-click="toggleAbout" icon="my-icons:info-outline"></paper-icon-button>

              <div class="bottom main-title">
                  <paper-fab id="basket-icon" mini icon="my-icons:shopping-basket"></paper-fab>
                  <paper-badge class="numitems" for="basket-icon" hidden$="[[!numItems]]" label="[[numItems]]"></paper-badge>
              </div>
          </paper-toolbar>
                  

          <!--<div class="cart-btn-container">
              <paper-fab id="basket-icon" mini icon="my-icons:shopping-basket"></paper-fab>-->
              <!--<paper-badge class="numitems" for="basket-icon" hidden$="[[!numItems]]" label="[[numItems]]"></paper-badge>-->
            <!--</div>-->

                  <iron-pages
                    selected="[[page]]"
                    attr-for-selected="name"
                    fallback-selection="list"
                    role="main">

                    <shop-list name="list"></shop-list>
                    <shop-basket name="basket" basket="[[basket]]" total="[[total]]"></shop-basket>
                  
                  </iron-pages>
                  <span class="spacer"></span>
                  <div>Hey</div>
        </paper-scroll-header-panel>
     
  </template>

  <script>
    Polymer({
      is: 'my-app',

      properties: {
        numItems: {
          type: Number,
          value: 0
        },
        
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged',
        },
      },

      observers: [
        '_routePageChanged(routeData.page)',
      ],

      listeners: {
        'add-basket-item': '_onAddBasketItem',
        'set-basket-item': '_onSetBasketItem',
        'clear-basket': '_onClearBasket'
      },

      _onAddBasketItem: function(event) {
        console.log(event);
        this.$.basket.addItem(event.detail);
      },

      _onSetBasketItem: function(event) {
        var detail = event.detail;
        this.$.basket.setItem(detail);
      },

      _onClearBasket: function() {
        this.$.basket.clearBasket();
      },

      _routePageChanged: function(page) {
        this.page = page || 'list';
      },

      _pageChanged: function(page) {
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl('shop-' + page + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },

      _showPage404: function() {
        this.page = 'list';
      },
    });
  </script>
</dom-module>
